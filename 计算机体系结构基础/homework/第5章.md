2020K8009929017 侯昱帆

1.分别说明图 5.6~5.9 所示四种结构中每个芯片包含冯·诺依曼结构五个部分的哪部分功能。
答：
图5.6 
CPU：控制器、运算器
北桥：存储器
南桥：I/O

图5.7
CPU：控制器、运算器
北桥：存储器、I/O
南桥：I/O

图5.8
CPU：控制器、运算器、存储器
北桥：I/O
南桥：I/O

图5.9
CPU：控制器、运算器、存储器
南桥：I/O

[[../notes/第5章 计算机组成原理和结构#5.3 计算机系统硬件结构发展]]

>见讲义

2.查阅资料，比较 Skylake 处理器和 Zen 处理器的运算器结构。
答：
Skylake：将浮点运算单元与整数运算单元做在了一起。
Zen：将浮点运算单元独立了出来。

[[../notes/第5章 计算机组成原理和结构#5.2.1 运算器]]

>见讲义

3.说明 ROB、保留站 (发射队列)、重命名寄存器在指令流水线中的作用，并查阅资料，比较Skylake 处理器和 Zen 处理器的 ROB、发射队列、重命名寄存器项数。
答：乱序执行技术中，在指令译码之后的读寄存器阶段，应判断指令需要的操作数是否准备好，若若没有准备好，就进入发射队列等待，直到操作数准备好后再进入执行阶段。
乱序执行的指令需要有序结束，故执行完的指令均进入ROB，并把执行结果临时写入重命名寄存器。ROB根据指令进入流水的次序，有序提交指令的执行结果。

Skylake  ROB：224项；发射队列：6μops；重命名寄存器：180项
Zen        ROB：192项；发射队列：6μops；重命名寄存器：168项

[[../notes/第5章 计算机组成原理和结构#乱序执行技术]]

>ROB (ReOrder Buffer)：使动态调度的指令按序提交（无序→有序）。
>保留站：保存未准备好的指令，使后续指令能先执行（有序→无序）。
>重命名寄存器：解决大部分的相关问题。
>
>Skylake
>ReOrder Buffer：224 entries
>Unified Reservation Station：97 entries
>Physical Register File：180 for integer，168 for vector/float
>
>Zen
>Retire Queue：192 entries
>Scheduling Queues：14×6 for integer，96 for FP/SIMD
>Physical Register File：168 for integer，160 for FP/SIMD
>（注：Physical Register File：物理寄存器堆，将结构寄存器和重命名寄存器合并为一个寄存器堆，一般使用全定制设计方式，具有多个读写端口。）

4.假设 A 处理器有两级 Cache，一级 Cache 大小为 32KB，命中率为 95%，命中延迟为 1 拍；二级 Cache 大小为 1MB，命中率为 80%，命中延迟为 30 拍，失效延迟为 150 拍。
B 处理器有三级 Cache，一级 Cache 大小为 32KB，命中率为 95%，命中延迟为 1 拍；二级 Cache 大小为256KB，命中率为 75%，命中延迟为 20 拍；三级 Cache 大小为 4MB，命中率为 80%，命中延迟为 50 拍，失效延迟为 150 拍。比较两款处理器的平均访问延迟。
答：
$AMAT_A=95\%\times1 + (1-95\%)\times[80\%\times30 + (1-80\%)\times150]=3.65$
$AMAT_B=95\%\times1 + (1-95\%)\times\{75\%\times20 + (1-75\%)\times[80\%\times50 + (1-80\%)\times150]\}=2.575$
B的访问延迟小于A

[[../notes/第5章 计算机组成原理和结构#高速缓存]]

>AMAT = HitTime + MissRate × MissPenalty
>MissPenalty：高速缓存失效时额外的访问延迟。 
>
>MissPenalty有三种理解：
>下级AMAT都理解为MissPenalty
>A：1 + 0.05 × (30 + 0.2 × 150) = 4
>B：1 + 0.05 × (20 + 0.25 × (50 + 0.2 × 150)) = 3
>最后一级的失效延迟!=MissPenalty，需要减去命中延时
>A：1 + 0.05 × (30 + 0.2 × 120) = 3.7
>B：1 + 0.05 × (20 + 0.25 × (50 + 0.2 × 100)) = 2.875
>每一级失效延迟!=MissPenalty ，需要减去命中延时
>A：1 + 0.05 × (29 + 0.2 × 120) = 3.65
>B：1 + 0.05 × (19 + 0.25 × (30 + 0.2 × 100)) = 2.575

5.假设某内存访问，行关闭、打开、读写各需要两拍，在行缓存命中率为 70% 和 30% 的情况下，采用 open page 模式还是 close page 模式性能更高？
答：
open page
命中率70%：$70\%\times2+(1-70\%)\times6=3.2拍$
命中率30%：$30\%\times2+(1-30\%)\times6=4.8拍$

close page
命中率70%和30%均需4拍

故命中率70%，openpage 模式性能更高；命中率30%，closepage 模式性能更高。

[[../notes/第5章 计算机组成原理和结构#^fff346]]

>close page：每次访问都开行、读写、关行。
>open page：命中时直接读写，否则要进行关行、开行、读写。
>关行也叫precharge，作用是将打开的行写回DRAM并无效该行，所以无需额外计算写回延时。
>
>为什么close page的读写延迟为4？总是为4吗？
>若不是连续访问同一bank，关行的延迟被对其他bank的访问所掩盖。(关行1的同时开行2)
>若连续访问同一bank，延迟为6。
>所以该题的close page其实有两种情况。

6.简要说明处理器和 IO 设备之间的两种通信方式的通信过程。
答：
PIO：存储器和IO设备之间的数据传送由处理器完成。
DMA：在存储器和IO设备之间开辟一条数据通道专门用于数据传输。

[[../notes/第5章 计算机组成原理和结构#5.4.2 处理器和 IO 设备之间的同步]]

>PIO：处理器直接读写IO设备的寄存器/存储空间。
>DMA：IO设备根据预先给出的DMA参数读写内存，处理器访问内存来获取IO设备的数据。

7.简要说明处理器和 IO 设备之间的两种同步方式的同步过程。
答：
查询：处理器向IO设备发出访问请求后，需不断读取IO设备的状态寄存器。
中断：当设备完成某个操作后，自行产生一个中断信号来中断处理器的执行。处理器被中断后，再去读取设备的状态寄存器。

[[../notes/第5章 计算机组成原理和结构#5.4.3 存储器和 IO 设备之间的数据传送]]

>轮询：处理器循环读取IO设备寄存器状态，获得需要的状态后进行相应的操作。
>中断：处理器接收IO设备中断，接收到中断后查询状态并进行操作。

8.在一个两片系统中，CPU 含内存控制器，桥片含 GPU、DC 和显存，简要说明在 PPT 翻页过程中, CPU、GPU、DC、显存、内存之间的同步和通信过程。
答：
1. 按下键盘，产生一个信号送到南桥芯片。
2. 南桥芯片向处理器发出一个外部中断信号。
3. 处理器收到中断信号，进入中断处理程序，读取中断原因。
4. 操作系统查找读到的空格是给谁的，并唤醒相应进程。
5. 进程将下一页要显示的内容准备好，调用操作系统中的显示驱动程序，把要显示的内容送到显存，由GPU通过访问显存空间刷新屏幕。

[[../notes/第5章 计算机组成原理和结构#5.4 处理器和 IO 设备间的通信]]

>1. CPU准备需要显示的数据和GPU需要执行的指令放在内存，并写GPU寄存器通知GPU开始工作；
>2. GPU通过DMA方式从内存读取指令和数据，并将结果绘制在显存中，完成后通过中断通知CPU任务完成；
>3. DC周期性持续地通过DMA访问显存，并输出到显示接口。

9.调查目前市场主流光盘、硬盘、SSD 盘、内存的价格，并计算每 GB 存储容量的价格。
答：

|类型|品牌|容量|价格|每GB价格|
|---|---|---|---|---|
|光盘|飞利浦DVD-R|4.7G×10|16.5元|0.35元/GB|
| |铼德|4.7G×50|54元|0.23元/GB|
|硬盘|希捷|2TB|393元|0.19元/GB|
| |西部数据|1TB|329元|0.32元/GB|
|SSD|三星|1TB|699元|0.68元/GB|
| |联想|1TB|519元|0.51元/GB|
|内存|金士顿|16G|419元|26.19元|
| |三星|8G|399元|49.88元|

[[../notes/第5章 计算机组成原理和结构#存储层次]]