## 一、光照模型和明暗处理
### 1. Lambert 光照模型
解释：模拟粗糙物体表面的光照现象
公式：
$$
I_d = K_d * I * dot(N, L) 
$$
<[基本光照模型系列——1.Lambert光照模型 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/144681176)>

### 2. Half Lambert 光照模型
解释：对Lambert模型的计算结果进行了重新映射，将\[0,1\]的计算结果置换到\[0.5,1\]之间，提升物体整体亮度。
公式：
$$
I_d = K_d * I * (dot(N, L) * 0.5 + 0.5)
$$

### 3. Phong 光照模型
解释：支持点光源和方向光源，是局部光照模型，漫反射光+镜面反射光+环境光

漫反射光效果
$$
I_d = I_iK_d * (L\cdot N)
$$
镜面反射光效果
$$
I_s = I_iK_s * (R\cdot V)^n
$$
环境光效果
$$
I_a = I_iK_a
$$
故视角方向的发光强度为
$$
I_d = I_iK_d * (L\cdot N) + I_iK_s * (R\cdot V)^n + I_iK_a
$$

### 4. 明暗处理
解释：物体表面的几何细节往往不规则，为了减缓由模型离散化所导致的不光滑的色彩效果，明暗处理除了使用光照模型，还要进行插值。
类型：
1. Gouraud明暗处理：对色彩进行插值
2. Phong明暗处理：对法向进行插值

## 二、视点变换和视点方向
### 1. 常见变换
刚体变换
相似变换
线性变换：
$$\begin{aligned}
L(p+q) &= L(p) + L(q) \\
aL(p) &= L(ap)
\end{aligned}$$
仿射变换：保持直线以及直线与直线的平行。
投影变换：保持直线。

### 2. 变换的表示
##### 普通表示
二维仿射变换
$$\begin{aligned}
x' = ax + by + c \\
y' = dx + ey + f
\end{aligned}$$
矩阵形式
$$
\begin{pmatrix}
x'\\
y'
\end{pmatrix} 
= 
\begin{pmatrix}
a&b\\
d&e
\end{pmatrix}
\begin{pmatrix}
x\\
y
\end{pmatrix}
+
\begin{pmatrix}
c\\
f
\end{pmatrix}
$$
$$
p' = Mp + t
$$

##### 齐次坐标
普通表示
$$
p' = Mp + t
$$
齐次坐标：使用四维数组来表示三维空间中的点和向量
$$
p' = Mp
$$

##### 变换复合
复合等价于矩阵乘法。
变换的复合不满足交换律，因为矩阵乘法不满足交换律。

### 3. 法向量变换
问题：有时物体的变换方程不适用于法向变换。
解决：先变换切平面，再通过切平面计算法向量，而不是直接计算法向量。
切平面
$$
v_{ws} = M v_{os}
$$
法向
$$
n_{ws} = (M^{-1})^T n_{os}
$$
法向的变换矩阵是原变换矩阵的逆的转置。

### 4. 视点和投影模式
##### 基本概念
眼睛：将三维场景感知为二维图像。
大脑：将二维图像重构为三维。
计算机图形学中，利用投影，模拟眼睛的功能和效果。
视点变换：与相机位置及朝向相关。
投影模式：将3D变换成2D的变换模式，包括正交投影和透视投影。

##### 正交投影
视点在无穷远，缺乏立体透视效果。
当xy平面是投影平面，(x, y, z) -> (x, y, 0)

##### 透视投影
视点在有限距离处，具有立体透视效果。
当视点位于原点，投影平面为z=d时，(x, y, z) -> ((d/z)x, (d/z)y, d)

## 三、绘制管线
### 1. 步骤
1. 顶点着色器：以一个单独的顶点为输入，将3D坐标转换为另一种3D坐标，并允许我们对顶点属性进行一些基本处理
2. 图元装配：处理顶点着色器输出的所有顶点和其连接关系，将点连接在一起组成点、线、面三种不同的图元。
3. 几何着色器：把图元形式的一系列顶点的集合作为输入，通过产生新顶点构造出新的（或其它的）图元来生成其他形状；或对图元的位置进行修改。
4. 光栅化：把图元映射为最终屏幕上的像素，生成供片段着色器使用的片段。
5. 片段着色器：计算一个像素的最终颜色。
6. 测试和混合：检测片段的对应深度值，以判断像素是在其他物体的前面还是后面，决定是否丢弃；检查alpha值（透明度）并对物体进行色彩混合。

### 2. 顶点着色器
<[计算机图形学二：视图变换(坐标系转化，正交投影，透视投影，视口变换) - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/144329075)>
1. 物体变换（物体坐标系->世界坐标系）
将物体通过平移、缩放、旋转放置在空间的某个位置。

2. 视图变换（世界坐标系->相机坐标系）
确定相机位置和朝向。

3. 投影变换（相机坐标系->裁剪体积空间）
选择相机镜头（广角、普通或望远镜），调整焦距和变焦系数以设置相机的视野。

4. 视口变换（裁剪体积空间->屏幕坐标系）
\[-1,-1\]\*\[-1,-1\] -> \[0,width\]\*\[0,height\]

### 3. 光栅化
光栅化目的：
1. 确定哪些片段在三角形内。
2. 将顶点属性（如颜色）内插到所有片段。

片段与像素区别：
片段：对应屏幕上的一个2D坐标，但不直接显示在屏幕上，也有很多其他属性（纹理坐标、深度值、alpha透明值等）。
像素：直接显示在屏幕上，没有其他属性。
