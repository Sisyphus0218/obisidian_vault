## 一、包围盒技术
### 1. 概念
如果光线没有和包围区域相交，那便不会和物体相交。
如果光线和包围区域相交，再继续判断光线是否和物体（或片元）相交以及计算相交的位置。

### 2. 分类
##### 轴向包围盒
包围盒法向和坐标轴平行，构建简单，但不能随物体旋转。
##### 方向包围盒
根据物体表面的顶点通过主成分分析获得特征向量，即包围盒主轴，进而构建包围盒。

### 3. 层次包围盒
##### 定义
二叉树的数据结构。叶节点表示物体或片元，内节点表示包围盒。
![[assets/Pasted image 20221129180043.png]]

##### 相交测试
对层次包围盒树执行搜索算法，从根节点开始递归进行相交检测：
1. 如果光线和当前节点包围盒相交，就继续和子节点做相交检测；
2. 如果光线和当前节点不相交，返回 false（不相交）；
3. 如果光线和物体相交，返回 true。

##### 分组
将一组物体分为两组，分割点在哪里？
1. 从中点分割；
2. 排序，两组物体按个数平均分；
3. 直接使用建模时候的层次化结构。

##### 构建
1. 求得所有物体的包围盒；
2. 将其中物体分为两组，分别求出包围盒；
3. 递归进行第二步，直到递归深度或组中只有一个物体。

### 4. 包围盒求交
##### Slab
Slab 指两个平行的平面，每个长方体由三个 Slab (三组相对的面) 构成。
![[assets/Pasted image 20221129182225.png]]

##### 光线与长方体的求交算法
基于 Slab 的快速长方体求交算法
对每个 Slab，计算其两个平面与光线的交点，并将这两个交点按照t的大小排序，记为
$$
t_i^{min},t_i^{max}(i=0,1,2)
$$
计算
$$
\begin{aligned}
t^{min}=max(t_0^{min},t_1^{min},t_2^{min})\\
t^{max}=min(t_0^{max},t_1^{max},t_2^{max})
\end{aligned}
$$
比较
$$
\begin{aligned}
&t^{min}<t^{max}\,\,光线与长方体相交\\
&否则，光线与长方体不相交
\end{aligned}
$$
![[assets/Pasted image 20221129183029.png]]

## 二、空间分割技术
### 1. 原理
1. 将景物空间分割成一个个小的空间单元。
2. 被跟踪的光线仅与它所穿过空间单元中所含物体表面进行求交测试。
3. 用相邻空间单元的空间连贯性，使一条光线快速跨越空单元，迅速到达非空单元，求得光线与景物的第一个交点。

### 2. 均匀格点法
将空间分为均匀的单元，光线通过单元向前追踪，直到和其中一个单元中的对象相交。

### 3. 八叉树
##### 概念
一个父节点有8个儿子节点：一个立方体区域分割为8个等大的小立方体区域。

##### 问题
子立方体只能被均匀的分割出来，若物体或片元在空间中不是均匀分布，构建出的八叉树不平衡。

##### 解决
允许分割平面的位置可变，不局限于立方体的平分面，这就引入了k-dimensional tree。

### 4. KD树
##### 建立
1. 找到包围盒；
2. 使用与坐标轴平行的平面划分包围盒直到满足停止划分的条件 eg. 最大划分数、最少物体数。
3. 将物体信息储存于叶子结点中。
![[assets/Pasted image 20221129185822.png]]

##### 求交
![[assets/Pasted image 20221129185859.png]]


### 5. 空间二分树（BSP树）
和KD tree相比，分割平面可以取任意的方向，是目前许多游戏环境里空间细分的行业标准。
![[assets/Pasted image 20221129180603.png]]

<[计算机图形学十三：利用包围盒技术加速光线追踪（KD-Tree and BVH） - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/144403802)>