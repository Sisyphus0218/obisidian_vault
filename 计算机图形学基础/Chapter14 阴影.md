## 一、阴影
### 1. 阴影域
这个被切去顶端的三棱锥称之为阴影域。
任何物体的任何一部分，只要在下图中切去顶端的三棱锥中，就属于阴影区域。
![[Pasted image 20230106020048.png]]

在绘制中，从视点向屏幕的某个像素投射一条射线，该射线与场景中某一物体交于一点。
需要确定该交点是否位于阴影当中，即判断该交点是否位于某个阴影域当中。

假设视点在所有的shadow volume之外。
维护一个计数器，其初始值是零。
当从视点射向目标像素的射线进入到一个shadow volume中时，将计数器 +1；
当射线从一个shadow volume中射出时， 将计数器 -1。
只需检验当射线到达交点时，计数器是否大于零：
如果大于零，则交点位于阴影中；否则不属于阴影区域。

使用模板缓存（Stencil Buffer）阴影绘制
1. 清空模板缓存。
2. 将整个场景绘制到帧缓存中，这次绘制只使用环境光分量和发光分量，并获取响应的颜色信息（在color buffer中）及深度信息（在z-buffer中）。
3. 关闭颜色缓存的写入和深度检测，绘制所有shadow volume的正面（即射线射入shadow volume时相交的面）。在这个过程中，如果一个像素其深度值小于之前算好的z-buffer中的深度值，那么将这个像素的模板缓存（stencil buffer）上的计数器+1。
4. 类似于前一步骤，将所有 shadow volume 的反面绘制一遍，只是这次是每发现一个像素其深度值小于之前算好的 z-buffer 中的深度值，将该像素的模板缓存上的 a-1。
5. 再将整个场景根据模板缓存的信息绘制上漫反射分量和高光分量：只有模板缓存是 0 的像素才绘制，以实现阴影效果

### 2. 阴影图
阴影图：使用深度缓存 z-buffer，可以获得从光源出发到任意一个方向最近点的距离，并以图像的形式存储下来。

绘制时，对于沿视点向屏幕每个像素发出的光线与场景中物体的交点，使用阴影图判断该点是否位于阴影区域：如果该交点到光源的距离大于阴影图上对应点所存储的深度值，则该点位于阴影中；否则，该点不在阴影中。

## 二、纹理
纹理使用三步骤
首先是纹理采集，这个步骤可以通过以下方式完成：手工绘制、拍照、过程纹理、纹理合成；
其次，纹理贴图，给定纹理图像和一个三维模型，还需要弄清楚如何将纹理映射到模型上。这可以通过给每个三维模型的顶点指定一个纹理坐标，并利用这个坐标把纹理图像上的色彩赋值给模型来实现。
最后，纹理滤波 (texture filtering)：在决定如何将纹理映射到物体上去之后，绘制时还需仔细地对纹理进行采样。否则，容易产生一些不好的人为痕迹(artifacts)，这种问题的产生源于信号处理理论中的一些基本问题。